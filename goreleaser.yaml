version: 2
project_name: pipeleak
builds:
  - id: "pipeleak"
    main: ./cmd/pipeleak
    binary: pipeleak
    goos:
      - linux
      - windows
    goarch:
      - amd64
      - arm64
    ldflags:
      - -s -w
      - -X github.com/CompassSecurity/pipeleak/internal/cmd.Version={{.Version}}
      - -X github.com/CompassSecurity/pipeleak/internal/cmd.Commit={{.Commit}}
      - -X github.com/CompassSecurity/pipeleak/internal/cmd.Date={{.Date}}
  # Platform-specific builds - only built on release (tagged builds)
  - id: "pipeleak-gitlab"
    skip: "{{ .IsSnapshot }}"
    main: ./cmd/pipeleak-gitlab
    binary: pipeleak-gitlab
    goos:
      - linux
      - windows
    goarch:
      - amd64
      - arm64
    ldflags:
      - -s -w
      - -X github.com/CompassSecurity/pipeleak/internal/cmd/common.Version={{.Version}}
      - -X github.com/CompassSecurity/pipeleak/internal/cmd/common.Commit={{.Commit}}
      - -X github.com/CompassSecurity/pipeleak/internal/cmd/common.Date={{.Date}}
  - id: "pipeleak-github"
    skip: "{{ .IsSnapshot }}"
    main: ./cmd/pipeleak-github
    binary: pipeleak-github
    goos:
      - linux
      - windows
    goarch:
      - amd64
      - arm64
    ldflags:
      - -s -w
      - -X github.com/CompassSecurity/pipeleak/internal/cmd/common.Version={{.Version}}
      - -X github.com/CompassSecurity/pipeleak/internal/cmd/common.Commit={{.Commit}}
      - -X github.com/CompassSecurity/pipeleak/internal/cmd/common.Date={{.Date}}
  - id: "pipeleak-bitbucket"
    skip: "{{ .IsSnapshot }}"
    main: ./cmd/pipeleak-bitbucket
    binary: pipeleak-bitbucket
    goos:
      - linux
      - windows
    goarch:
      - amd64
      - arm64
    ldflags:
      - -s -w
      - -X github.com/CompassSecurity/pipeleak/internal/cmd/common.Version={{.Version}}
      - -X github.com/CompassSecurity/pipeleak/internal/cmd/common.Commit={{.Commit}}
      - -X github.com/CompassSecurity/pipeleak/internal/cmd/common.Date={{.Date}}
  - id: "pipeleak-devops"
    skip: "{{ .IsSnapshot }}"
    main: ./cmd/pipeleak-devops
    binary: pipeleak-devops
    goos:
      - linux
      - windows
    goarch:
      - amd64
      - arm64
    ldflags:
      - -s -w
      - -X github.com/CompassSecurity/pipeleak/internal/cmd/common.Version={{.Version}}
      - -X github.com/CompassSecurity/pipeleak/internal/cmd/common.Commit={{.Commit}}
      - -X github.com/CompassSecurity/pipeleak/internal/cmd/common.Date={{.Date}}
  - id: "pipeleak-gitea"
    skip: "{{ .IsSnapshot }}"
    main: ./cmd/pipeleak-gitea
    binary: pipeleak-gitea
    goos:
      - linux
      - windows
    goarch:
      - amd64
      - arm64
    ldflags:
      - -s -w
      - -X github.com/CompassSecurity/pipeleak/internal/cmd/common.Version={{.Version}}
      - -X github.com/CompassSecurity/pipeleak/internal/cmd/common.Commit={{.Commit}}
      - -X github.com/CompassSecurity/pipeleak/internal/cmd/common.Date={{.Date}}

archives:
  - id: pipeleak-archive
    builds:
      - pipeleak
    format: tar.gz
    format_overrides:
      - goos: windows
        format: zip
  - id: pipeleak-gitlab-archive
    builds:
      - pipeleak-gitlab
    format: tar.gz
    format_overrides:
      - goos: windows
        format: zip
  - id: pipeleak-github-archive
    builds:
      - pipeleak-github
    format: tar.gz
    format_overrides:
      - goos: windows
        format: zip
  - id: pipeleak-bitbucket-archive
    builds:
      - pipeleak-bitbucket
    format: tar.gz
    format_overrides:
      - goos: windows
        format: zip
  - id: pipeleak-devops-archive
    builds:
      - pipeleak-devops
    format: tar.gz
    format_overrides:
      - goos: windows
        format: zip
  - id: pipeleak-gitea-archive
    builds:
      - pipeleak-gitea
    format: tar.gz
    format_overrides:
      - goos: windows
        format: zip

release:
  github:
    owner: CompassSecurity
    name: pipeleak
